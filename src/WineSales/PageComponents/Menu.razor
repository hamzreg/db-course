@inject NavigationManager NavigationManager
@inject WineSales.Domain.Interactors.IUserInteractor UserInteractor

<Bar Breakpoint="Breakpoint.Desktop"
     Background="Background.Light"
     ThemeContrast="ThemeContrast.Light">
    <BarBrand>
        WineSales
    </BarBrand>
    <BarToggler />
    <BarMenu>
        <BarStart>
            <BarItem>
                <BarLink To="/">Главная</BarLink>
            </BarItem>
            <BarItem>
                <BarLink To="wines">Каталог вин</BarLink>
            </BarItem>
            @if (nowUser.Role == "customer")
            {
                <BarItem>
                    <BarLink To="">Мои покупки</BarLink>
                </BarItem>
                <BarItem>
                    <BarLink To="">Бонусная карта</BarLink>
                </BarItem>
            }
            else if (nowUser.Role == "supplier")
            {
                <BarItem>
                    <BarLink To="">Мои вина</BarLink>
                </BarItem>
                <BarItem>
                    <BarLink To="">Мои продажи</BarLink>
                </BarItem>    
            }
        </BarStart>
        <BarEnd>
            <BarItem>
                @if (nowUser.Role == "guest")
                {
                    <Button Color="Color.Primary" Clicked="@ShowLogin">Вход в аккаунт</Button>
                    <Button Color="Color.Primary" Clicked="@ShowRegistration">Регистрация</Button>
                }
                else
                {
                    <Button Color="Color.Primary" Clicked="@SignOut">Выход из аккаунта</Button>
                }
            </BarItem>
        </BarEnd>
    </BarMenu>
</Bar>

<Login @ref=@loginModal/>

@code{
    private Login? loginModal;

    User nowUser;

    protected override void OnInitialized()
    {
        nowUser = UserInteractor.GetNowUser();
        Console.WriteLine(nowUser.Role);
    }

    Task ShowLogin()
    {
        loginModal?.ShowModal();
        return Task.CompletedTask;
    }

    Task ShowRegistration()
    {
        return Task.CompletedTask;
    }

    public void SignOut()
    {
        User guestUser = new User("guest", "guest", "guest");
        UserInteractor.SetNowUser(guestUser);
        nowUser = UserInteractor.GetNowUser();
        NavigationManager.NavigateTo(NavigationManager.Uri, true);
    }
}